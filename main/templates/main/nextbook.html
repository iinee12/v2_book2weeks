{% extends "main/layout.html" %}
<!DOCTYPE html> {% load static %} {% load mathfilters %} {% block content %}

<section>

    <div class="container">
        <div class="category-tab">
            <!--category-tab-->
            <div class="col-sm-12">
                <ul class="nav nav-tabs">
                    <li id="bookmenu1">
                        <a href="" onclick="f_gobookmenu(1)" data-toggle="tab">읽은책</a>
                    </li>
                    <li id="bookmenu3">
                        <a href="" onclick="f_gobookmenu(3)" data-toggle="tab">읽는책</a>
                    </li>
                    <li id="bookmenu2" class="active">
                        <a href="" onclick="f_gobookmenu(2)" data-toggle="tab">읽을책</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="left-sidebar">
                <h2>menu</h2>
                <div class="panel-group category-products" id="accordian">
                    <!--category-productsr-->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a href="/nextbook/">검색하기</a>
                            </h4>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h4 class="panel-title">
                                <a href="/book/">등록된 책</a>
                            </h4>
                        </div>
                    </div>
                </div>
                <!--/category-products-->
            </div>
        </div>

        <div class="col-sm-9 padding-right">
            <div class="features_items">
                <h2 class="title text-center">Book</h2>
            </div>

            <div class="category-tab">
                <div class="searchBar">
                    <span class='green_window'>
                        <input type='text' id="searchKey" name="searchKey" class='input_text' placeholder="책 제목 또는 작가이름" />
                    </span>
                    <button type='submit' onclick="f_searchnextbook()" class='sch_smit'>검색</button>
                </div>                
            </div>
            {% if nosearch == '' %}
            <img style="margin-left: auto; margin-right: auto; display: block;margin-top:30px;"
            src="{% static 'images/content/noresult.png' %}"/>
               <h2 style="text-align: center;">검색결과가 존재하지 않습니다.
                   <br/>검색어를 다시 한번 확인해 주세요!</h2>
            {% else %}
            {% for ourbook in searchBook %}
            
            <div class="col-sm-3" style="margin-top:30px;">
                <div class="product-image-wrapper">
                    <div class="single-products">
                        <div class="productinfo">
                            <a onclick="f_modalDisplay('{{ ourbook.isbn }}')"><img src="http://image.kyobobook.co.kr/images/book/large/{{ ourbook.imgIndex }}/l{{ ourbook.isbn }}.jpg"
                                 onerror="this.src='{{ ourbook.imgAlt }}'" /></a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
            <!-- The Modal -->
            <div id="myModal" class="modal">
 
            <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>                                                               
                    <p>Some text in the Modal..</p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function f_gobookmenu(menuid) {
        if (menuid == 1) {
            location.href = "/book/";
        } else if (menuid == 2) {
            location.href = "/nextbook/";
        } else {
            location.href = "/nowbook/";
        }
    }

    function f_searchnextbook(){
        var searchKey = document.getElementById('searchKey').value;

        if (searchKey == null || searchKey.trim() == ''){
            alert("검색어를 입력해주세요!");
            return false;
        }

        location.href="/nextbooksearch?searchKey="+searchKey;
        return false;
    }



    var span = document.getElementsByClassName("close")[0];
    var modal = document.getElementById('myModal');
    // When the user clicks on the button, open the modal 
    function f_modalDisplay(isbn) {
        $.ajax({ // .like 버튼을 클릭하면 <새로고침> 없이 ajax로 서버와 통신하겠다.
            type: "POST", // 데이터를 전송하는 방법을 지정
            url: "/wishBookdetail/", // 통신할 url을 지정
            data: {'isbn': isbn, 'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터 전송시 옵션
            dataType: "json", 
            success: function(response){ // 통신 성공시 - 동적으로 좋아요 갯수 변경, 유저 목록 변경
                alert(response.message)
            },
            error: function(request, status, error){ // 통신 실패시 - 로그인 페이지 리다이렉트
                alert("로그인이 필요합니다.")
            },
        });
        modal.style.display = "block";
    }
 
    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }
</script> {% endblock %}